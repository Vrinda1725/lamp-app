name: Talisman integration

on:
  push:
    branches:
      - main

jobs:
  talisman_scan:
    name: Run Talisman Scan on History and Current Files
    runs-on: ubuntu-latest

    steps:
      # Checkout the repository
      - name: Checkout Code
        uses: actions/checkout@v3

      # Install Talisman
      - name: Install Talisman
        run: |
          curl -L https://thoughtworks.github.io/talisman/install.sh | bash
          sudo chmod +x ~/.git/hooks/pre-push

      # Make sure Talisman is in the PATH
      - name: Add Talisman to PATH
        run: |
          export PATH=$PATH:~/.git/hooks
          echo "Talisman installed to path"

      # Scan the repository's commit history and current files
      - name: Run Talisman Scan on History and Current Files
        run: |
          export PATH=$PATH:~/.git/hooks
          talisman --scan-history --scan-all --output-format text > talisman-report.txt

      # Display the Talisman report in the logs
      - name: Display Talisman Report
        run: |
          cat talisman-report.txt

      # Optional: Upload the report as an artifact
      - name: Upload Talisman Report as Artifact
        uses: actions/upload-artifact@v3
        with:
          name: talisman-report
          path: talisman-report.txt

    
